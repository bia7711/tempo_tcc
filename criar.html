<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Sign Up - Tempo de Florescer</title>
    <!-- Incluindo o style.css para o feedback de cores -->
    <link rel="stylesheet" href="./css/style.css"> 
    <link rel="stylesheet" href="./css/entrarecriar.css">
    <link rel="stylesheet" href="./css/nav.css">
    <link rel="stylesheet" href="./css/responsivo.css">
    
</head>
<body>
    <nav>
        <div>
            <img src="./img/novalogo.png" alt="logo">
        </div>
        <div class="alinhamento">
              <ul>
                  <li><a href="./index.html">Home</a></li> 
                <li><a href="./quemsomos.html">Quem somos</a></li>
                <li><a href="./contatos.html">Contato</a></li>
                <li><a href="./doacao.html">Doe</a></li>
                <li><a href="./voluntarios.html">Voluntários</a></li>
                <li><a href="entrarempresas.html">Empresas</a></li> 
 
              </ul>
          
      </div>
      </nav>
      <div class="alinhamentocontainer">
        <!-- 1. ENVOLVEMOS TUDO NO FORMULARIO COM ID formCadastro -->
        <form id="formCadastro" class="signup-container">
            <h2>Criar conta</h2>
            
            <!-- ALTERAÇÃO AQUI: Removido '(Opcional):' e adicionado 'required' -->
            <div class="input-group">
                <label for="cpf">CPF:</label>
                <input type="text" id="cpf" name="cpf" placeholder="Seu CPF" required>
            </div>
            
            <div class="input-group">
                <label for="nome">Nome:</label>
                <input type="text" id="nome" name="nome" placeholder="Seu nome" required>
            </div>
            <div class="input-group">
                <label for="sobrenome">Sobrenome:</label>
                <input type="text" id="sobrenome" name="sobrenome" placeholder="Seu sobrenome" required>
            </div>
            <div class="input-group">
                <label for="email">Email:</label>
                <input type="email" id="email" name="email" placeholder="Seu email" required>
            </div>
            <div class="input-group">
                <label for="senha">Senha:</label>
                <input type="password" id="senha" name="senha" placeholder="Sua senha" required>
            </div>
            <div class="input-group">
                <!-- 2. CORRIGIDO O ID PARA 'confirmaSenha' para corresponder ao JS do Backend -->
                <label for="confirmaSenha">Confirmar Senha:</label>
                <input type="password" id="confirmaSenha" name="confirmaSenha" placeholder="Confirme sua senha" required>
            </div>
            <div style="display: flex; align-items: center;">
                <input type="checkbox" id="termos" name="termos">
                <label for="termos">Eu concordo com os <a href="./termos.html" target="_blank">Termos e Condições</a></label>
            </div>
            
            <!-- 3. LOCAL PARA MENSAGENS DE SUCESSO/ERRO -->
            <div id="mensagemFeedback" class="text-center mt-4 p-2"></div>
            
            <!-- O botão deve ser do tipo 'submit' -->
            <button type="submit">Criar conta</button>
            
            <p class="terms">Já tem uma conta? <a href="./entrar.html">Entrar</a></p>
            <p class="terms">Esqueceu sua senha? <a href="./redefinirsenha.html">Redefinir senha</a></p>
        </form>
        </div>
        
    <!-- 4. SCRIPT DE CADASTRO -->
    <script>
        // Arquivo: criar.html (Dentro de <script> no final do <body>)

document.addEventListener('DOMContentLoaded', () => {
    // 1. URL do seu Backend (a porta 3001 foi definida no seu server.js)
    const BASE_URL = 'http://localhost:3001'; 
    const formCadastro = document.getElementById('formCadastro');
    const mensagemFeedback = document.getElementById('mensagemFeedback');

    if (formCadastro) {
        formCadastro.addEventListener('submit', async (e) => {
            e.preventDefault(); // Impede o envio padrão do formulário

            // Oculta mensagens anteriores
            mensagemFeedback.textContent = '';
            // Se você não usa Tailwind, essas classes não existirão. Use o style.css para as cores.
            // Aqui estamos apenas limpando as classes de feedback
            mensagemFeedback.classList.remove('text-green-600', 'text-red-600'); 
            mensagemFeedback.style.color = ''; // Limpa cor customizada

            // 2. Captura os dados do formulário
            const nome = document.getElementById('nome').value;
            const sobrenome = document.getElementById('sobrenome').value;
            const email = document.getElementById('email').value;
            const senha = document.getElementById('senha').value;
            // Usando o ID corrigido: confirmaSenha
            const confirmaSenha = document.getElementById('confirmaSenha').value;
            // O campo CPF, agora obrigatório
            const cpf = document.getElementById('cpf').value; 
            
            const termos = document.getElementById('termos').checked;

            // 3. Validação de Termos
            if (!termos) {
                exibirFeedback('Você deve concordar com os Termos e Condições.', 'erro');
                return;
            }

            // 4. Cria o objeto de dados a ser enviado
            const dadosCadastro = {
                nome,
                sobrenome,
                email,
                senha,
                confirmaSenha,
                cpf 
            };

            // 5. Envia a requisição para o Backend
            try {
                const response = await fetch(`${BASE_URL}/api/auth/cadastro`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(dadosCadastro),
                });

                const data = await response.json();

                if (response.ok) {
                    // Status 201 (Sucesso)
                    exibirFeedback(data.mensagem || 'Cadastro realizado com sucesso! Redirecionando para a página de voluntários...', 'sucesso');
                    // Opcional: Redirecionar após 3 segundos
                    setTimeout(() => {
                        window.location.href = 'voluntarios.html'; 
                    }, 3000);
                } else {
                    // Status 400 (Validação), 409 (Email ou CPF já existem), 500 (Erro Interno)
                    exibirFeedback(data.mensagem || 'Ocorreu um erro desconhecido no cadastro.', 'erro');
                }
            } catch (error) {
                // Erro de rede (servidor Node não está rodando, por exemplo)
                console.error('Erro de conexão:', error);
                exibirFeedback('Erro de conexão: Verifique se o servidor está ativo.', 'erro');
            }
        });
    }

    // Função auxiliar para exibir mensagens
    function exibirFeedback(mensagem, tipo) {
        mensagemFeedback.textContent = mensagem;
        mensagemFeedback.style.fontWeight = 'bold'; // Adiciona destaque
        
        if (tipo === 'sucesso') {
            // Cor verde para sucesso (ajuste o código hexadecimal se necessário)
            mensagemFeedback.style.color = '#10B981'; 
        } else if (tipo === 'erro') {
            // Cor vermelha para erro (ajuste o código hexadecimal se necessário)
            mensagemFeedback.style.color = '#EF4444'; 
        }
    }
});
    </script>
</body>
</html>